# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Архитектура приложения
При постоение приложения используется архитектурный паттерн Model-View-Presenter (MVP), который делит модули на три слоя:
- Модель (Model) - Cодержит данные приложения;
- Представление (View) - Показывает эти данные в понятном для пользователя виде;
- Презентер (Presenter) - Отвечает за логику обработки данных, обновления представления и обработки пользовательских команд.

### Слои архитектуры приложения 
1. Модель (Model):
- AppData;
- ProjectApi;

2. Представление (View):
- Basket;
- Form;
- Modal;
- Success;
- Card;
- CardInBasket;
- OrderDeliveryForm;
- OrderContactsForm;
- Page;

3. Презентер (Presenter):
- index.ts

4. Базовые классы (base):
- Api;
- Component;
- Events;
- Model;

## Интерфейсы данных

### Интерфейс IItem
Структура данных товара.

Свойства:
- id - Уникальный идентификатор товара;
- description - Описание товара;
- image - Ссылка на изображение товара (url);
- title - Название товара;
- category - Категория товара;
- price - Цена товара (может быть бесплатным - null)

```TypeScript
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

### Интерфейс IOrderDetails
Структура формы заказа товара.

Свойства:
- payment - Способ оплаты товара;
- email - Email-адрес пользователя;
- phone - Контактный телефон пользователя;
- address - Адрес доставки товара;
- total - Общая стоимость товаров в заказе;
- items - Массив купленных товаров.

```TypeScript
interface IOrderDetails {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
}
```

### Интерфейс IOrderResult
Структура итоговой формы заказа товара.

Свойства:
- id - Уникальный идентификатор товара;
- total - Общая стоимость товаров в заказе.

```TypeScript
interface IOrderResult {
    id: string;
    total: number;
}
```

### Интерфейс IConatcts
Структура выбора оплаты и указания адреса доставки.

Свойства:
- payment - Способ оплаты товара;
- address - Адрес доставки товара.

```TypeScript
interface IDelivery {
    payment: TPayment;
    address: string;
}
```

### Интерфейс IConatcts
Структура контактных данных пользователя.

Свойства:
- email - Email-адрес пользователя;
- phone - Контактный телефон пользователя.

```TypeScript
interface IContacts {
    email: string;
    phone: string;
}
```

### Интерфейс IItemList
Структура списка товаров, полученных из API.

Свойства:
- total - Количество товаров на странице;
- items - Массив товаров на странице;

```TypeScript
interface IItemList {
    total: number;
    items: IItem[];
}
```

### Интерфейс IActionsCard
Интерфейс действий пользователя.

Метод:
- onClick - Обработчик клика по карточке;

## Типы данных

### Тип TPayment
Тип для выбора способа оплаты при заказе.
```TypeScript
type TPayment = 'card' | 'cash' | '';
```

### Тип FormError
Тип ошибки формы.
```TypeScript
type FormError = Partial<Record<keyof IOrderDetails, string>>;
```

### Тип CatalogChangeEvent
Объект события с обновленным каталогом товаров.
```TypeScript
type CatalogChangeEvent = {
    catalog: IItem[]
};
```

## Классы модели

### Класс AppState
Класс управления состоянием приложения

Свойства:
- catalog - Массив товаров в каталоге, по умолчанию пустой;
- basketItems - Массив ID товаров в корзине, по умолчанию пустой;
- basketSum - Общая сумма товаров в корзине, по умолчанию значение 0;
- preview - Текущий просматриваемый товар;
- oreder - Объект заказа;
- formErrors - Объект для хранения ошибок формы, по умолчанию пустой.

Методы:
- setCatalog - Метод для установки каталога товаров;
- setPreview - Метод для установки товара для превью;
- addToBasket - Метод добавления товара в корзину;
- removeFromBasket - Метод удаления товара из корзины;
- clearBasket - Метод очистки корзины товаров;
- getBasketSum - Метод для получения суммы товаров, находящихся в корзине;
- clearOrder - Метод для очистки заказа товаров;
- getBasketQuantity - Метод для отображения количества товаров, находящихся в корзине;
- isItemInBasket - Метод проверки нахождения товара в корзине;
- setDeliveries - Метод для установки значений способа оплаты и адреса доставки;
- validateDelivery - Метод валидации данных доставки и способа оплаты;
- setContacts - Метод для установки контактных данных;
- validateContacts - Метод валидации контактных данных;
- getBasketProducts - Метод получения товаров, находящихся в корзине;
- getCollectedOrder - Метод формирования данных заказа;
- resetOrderData - Метод для сброса данных заказа.

### Класс ProjectApi
Класс для полученные данных с сервера и отправки заказа на сервер

Методы:
- getItemList - Метод получения списка карточек товара;
- orderPlaced - Метод для оформления заказа.

## Классы представления

### Класс Basket
Класс корзины, отвечает за отображение элементов корзины

Методы:
- items - Сеттер для обновления списка товаров в корзине и определения состояния кнопки;
- total – Сеттер для установки стоимости всех товаров в корзине.

### Класс Form
Класс управления отображением содержимого модального окна с формой ввода данных

Методы:
- onInputChange – Метод для отслеживания изменений в полях ввода формы;
- valid - Сеттер для изменения состояния кнопки по итогу валидации полей;
- errors - Сеттер для вывода текста ошибки;
- render - Метод рендеринга компонента с переданным состоянием.

### Класс Modal
Класс управления модальными окнами

Методы:
- content– сеттер для устанавки содержимое модального окна;
- open – открытие модального окна;
- close – закрытие модального окна;
- render - рендеринг модального окна; 

### Класс Success
Класс отвечается за отображение сообщения об успешном оформлении заказа

Методы:
- orderSum - указывает итоговую сумму оформленного заказа.

### Класс Page
Класс, в котором описывается главная страница.

### Класс Card
Класс, в котором описывается карточка товара.

### Класс Order
Класс, в котором описывается окно заказа товара.

### Класс Contacts
Класс, в котором описывается окно контактных данных пользователя.

## Базовые классы приложения

### Класс для работы с Api
Данный класс отвечает за взаимодействие с сервером.

Методы:
- handleResponse - Обработчик ответа от сервера. Проверяет успешный ли ответ от сервера. В случае успешного ответа возвращает распарсенный JSON-ответ, в случае ошибки пытается получить JSON с описанием ошибки и возвращает отклонённый промис;
- get - Выполняет 'GET'-запрос, используется для получения данных от сервера;
- post - Выполняет 'POST' | 'PUT' | 'DELETE' -запрос (по умолчанию 'POST'), используется для отправки данных на сервер |  для добавления новых или изменения существующих данных на сервере | для удаления данных на сервере.

### Класс Component
Базовый компонент.

Методы:
- toggleClass - Для переключения класса;
- setText - Для установки текстового содержимого;
- setDisabled -  Для смены статуса блокировки кнопки;
- setVisible - Позволяет показать элемент
- setHidden - Позволяет скрыть элемент;
- setImage - Для установки изображение с алтернативным текстом;
- render - Вернуть корневой DOM элемент.

### Класс EventEmitter
Брокер событий.

Методы:
- on - Устанавливает обработчик на событие;
- off - Убирает обработчик с события;
- emit - Инициировать событие с данными;

Дополнительные методы:
- onAll - Устанавливает обработчик на все события;
- offAll - Убирает обработчки со всех событий;
- trigger - Выполняет коллбек триггер, генерирующий событие при вызове.

### Класс Model
Базовый компонент.

Методы:
- emitChanges - Сообщает всем о изменении модели.

### Класс Card
Класс данных карточки товара

Методы:
- description - Сеттер для установки описания карточки товара;
- image - Сеттер для установки изображения карточки товара;
- set title - Сеттер для установки заголовка карточки товара;
- get title - Геттер для получения заголовка карточки товара;
- category - Сеттер для установки категории товара;
- price - Сеттер для установки цены в карточку товара;
- button - Сеттер для установки текста кнопки в карточке товара;
- getContainer - Метод для получения контейнера карточки.

### Класс CardInBasket
Класс данных карточки товара, находящейся в корзине

Методы:
- title - Сеттер для установки заголовка товара;
- price - Сеттер для установки цены товара;
- index - Сеттер для установки порядкового номера товара в корзине.

### Класс OrderDeliveryForm
Класс для работы с данными, при заполнении поля адреса доставки и указания способа оплаты

Методы:
- handlePayment - Функция для добавления класса активного состояния кнопок;
- address - Сеттер для установки адреса доставки;
- resetPaymentButtons - Функция для снятия класса активного состояния кнопок.

### Класс OrderContactsForm
Класс для работы с данными, при заполнении полей Email-адреса и телефона

Методы:
- email - Сеттер для установки Email-адреса;
- phone - Сеттер для установки телефона.

### Класс Page
Класс представления главной страницы приложения

Методы:
- counter - Сеттер для установки количества товаров, находящихся в корзине;
- catalog - Сеттер для установки каталога товаров на страницу;
- locked - Сеттер для блокировки скролла(прокрутки) страницы при открытии/закрытии модального окна.


### Описание событий

События, которые инициируются при изменении данных:
- 'items:changed' - Изменение массива товаров;
- 'basket:changed' - Изменение корзины товаров;

События, которые инициируются при взаимодействии пользователя с интерфейсом:
- 'modal:open' - Открытие модального окна;
- 'preview:change' - При открытии превью карточки;
- 'item:select' - При клике на карточку товара;
- 'item:addToBasket' - При клике на кнопку "В корзину";
- 'item:deleteFromBasket' - При клике на кнопку удаления товара из корзины;
- 'basket:open' - При клике на кнопку "Корзина";
- 'order:open' - При клике на кнопку "Оформить";
- 'payment:change' - При выборе способа оплаты;
- 'address:change' - При заполнении адреса доставки;
- 'deliveriesFormErrors:change' - При выборе способа оплаты и вводе адерса;
- 'order:submit' - При клике на кнопку "Далее", после заполнения адреса и выбора способа оплаты;
- 'contactsFormErrors:change' - При вводе Email-адреса и телефона;
- 'contacts:submit' - При клике на кнопку "Оплатить", после заполнения телефона и электронной почты;
- 'modal:close' - При клике на кнопку закрытия модального окна или при клике на оверлей.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
